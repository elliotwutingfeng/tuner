---
app-id: io.github.louis77.tuner

runtime: org.freedesktop.Platform
runtime-version: '24.08'

sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.vala
  
base: io.elementary.BaseApp
base-version: 'circe-24.08'
  
command: io.github.louis77.tuner

build-options:
  prepend-path: /usr/lib/sdk/vala/bin/
  prepend-ld-library-path: /usr/lib/sdk/vala/lib
  
add-extensions:
  org.freedesktop.Sdk.Extension.vala:
    version: '24.08'
    directory: vala
    autodelete: true

finish-args:
  - "--share=ipc"
  - "--socket=fallback-x11"
  - "--socket=wayland"
  - "--talk-name=org.gtk.vfs.*"
  - "--filesystem=xdg-run/gvfsd"
  - "--filesystem=xdg-desktop"
  - "--share=network"
  - "--metadata=X-DConf=migrate-path=/com/github/louis77/tuner/"
  - "--socket=pulseaudio"
  - "--talk-name=org.freedesktop.Notifications"
  - "--own-name=org.mpris.MediaPlayer2.Tuner"
  - "--env=PATH=/usr/bin:/app/bin:/app/vala/bin"
  - "--env=LD_LIBRARY_PATH=/app/vala/lib:/app/lib:/lib"

cleanup:
  - "/include"
  - "/lib/pkgconfig"
  - "/share/pkgconfig"
  - "/share/aclocal"
  - "/man"
  - "/share/man"
  - "/share/gtk-doc"
  - "/share/vala"
  - "*.la"
  - "*.a"

modules:
- name: vala
  buildsystem: simple
  build-commands:
    - install -d /app/vala
- name: libsoup
  buildsystem: meson
  builddir: true
  config-opts:
    - "--buildtype=release"
    - "-Dvapi=enabled"
    - "-Dtests=false"
    - "-Dgssapi=disabled"
    - "-Dsysprof=disabled"
  sources:
    - type: git
      url: https://gitlab.gnome.org/GNOME/libsoup.git
      tag: 3.6.1
      commit: 8b46a93bc1cbadb22dcdbb6844d9616723376535

- name: taglib
  buildsystem: cmake-ninja
  config-opts:
    - "-DBUILD_SHARED_LIBS=ON"
    - "-DCMAKE_BUILD_TYPE=Release"
  sources:
    - type: git
      url: https://github.com/taglib/taglib.git
      tag: v2.0.2
      commit: e3de03501ff66221d1f1f971022b248d5b38ba06

- name: gee
  buildsystem: autotools
  build-options:
    cflags: -Wno-error=incompatible-pointer-types
  cleanup: ["*"]
  sources:
    - type: archive
      url: https://download.gnome.org/sources/libgee/0.20/libgee-0.20.6.tar.xz
      sha256: 1bf834f5e10d60cc6124d74ed3c1dd38da646787fbf7872220b8b4068e476d4d

- name: granite
  buildsystem: meson
  config-opts:
    - "--buildtype=release"
  sources:
    - type: archive
      url: https://github.com/elementary/granite/archive/refs/tags/6.2.0.tar.gz
      sha256: 067d31445da9808a802fca523630c3e4b84d2d7c78ae547ced017cb7f3b9c6b5

- name: tuner
  buildsystem: meson
  build-options:
    cflags: "-g"
    cxxflags: "-g"
    buildtype: "debug"
  config-opts:
  - "--buildtype=debug"
  post-install:
  - install -Dm644 /app/share/icons/hicolor/64x64/apps/${FLATPAK_ID}.svg  -t /app/share/icons/hicolor/128x128/apps/
  sources:
  - type: dir
    path: .
